!function(){function e(){var e=c(),n=r(e,b,Number.NEGATIVE_INFINITY,!0);s(n)}function r(e,t,a,o){if(0>=t)return n(e);r.table||(r.table={});var l=v(e),f=r.table[l];if(f&&f.depth>=t&&(!f.isBound||f.value<=a))return o?f.move:f.value;var c=[P,L,K,O];if(f){var s=c.indexOf(f.move),d=c[s];c[s]=c[0],c[0]=d}for(var m=void 0,h=!1,g=0;g<c.length;g++){var y=i(e),b=c[g];if(u(y,b)){m=m||b;for(var k=Number.POSITIVE_INFINITY,M=y.length-1;M>=0&&k>a;M--)y[M]||(y[M]=2,k=Math.min(k,r(y,t-1,a)),y[M]=0);k>a&&(a=k,m=b,h=!0)}}return m?(r.table[l]={depth:t,value:a,move:m,isBound:!h},o?m:a):o?K:N+n(e)}function n(e,r){for(var n=0,o=0,l=0,i=0,f=0,u=0;A>u;u++)for(var v=0;A>v;v++){var c=a(e,u,v);if(c){if(o+=c*B[u*A+v],A-1>v){var s=a(e,u,v+1);if(s&&(l+=t(c,s)*Math.log(c+s),A-2>v)){var d=a(e,u,v+2);if(d&&t(c,d)<=1.1){var m=Math.min(c,d);i+=t(m,s)*Math.log(m)}}}if(A-1>u&&(s=a(e,u+1,v),s&&(l+=t(c,s)*Math.log(c+s),A-2>v))){var d=a(e,u+2,v);if(d&&t(c,d)<=1.1){var m=Math.min(c,d);i+=t(m,s)*Math.log(m)}}}else f++}var h=11.12249+-11.06513413/(1+Math.pow(f/2.480941,2.717769));return n+=E*o,n+=w*h,n+=I*l,n+=C*i,r&&console.log("EVALUATION     "+n+"\n  position     "+E*o+"\n  numEmpty     "+w*h+"\n  adjDiff      "+I*l+"\n  insulation   "+C*i+"\n"),n}function t(e,r){return e>r?T[e]-T[r]:T[r]-T[e]}function a(e,r,n){return e[r*A+n]}function o(e,r,n,t){e[r*A+n]=t}function l(e){function r(e,r){for(r-=e.length;r-->0;)e=" "+e;return e}for(var n="",t=0;A>t;t++){for(var o=0;A>o;o++){var l=a(e,t,o);n+=l?r(l+"",5):"    ."}n+="\n"}console.log(n)}function i(e){return e.slice()}function f(e,r){return e>=0&&A>e&&r>=0&&A>r}function u(e,r){for(var n=r.dir*(A-1),t=(1-r.dir)*(A+1)-1,l=1-2*r.dir,i=!1,u=n;u!=t;u+=l)for(var v=n;v!=t;v+=l)if(a(e,u,v))for(var c=u+r.drow,s=v+r.dcol,d=u,m=v;f(c,s);){var h=a(e,c,s),g=a(e,d,m);if(h){if(h===g){o(e,c,s,-2*g),o(e,d,m,0),i=!0;break}}else o(e,c,s,g),o(e,d,m,0),i=!0;d=c,m=s,c+=r.drow,s+=r.dcol}if(!i)return!1;for(var y=0,b=0;b<e.length;b++)e[b]<0?e[b]*=-1:e[b]||y++;if(0===y)throw"No empty squares after making move.";return!0}function v(e){if(!v.table1){v.table1={},v.table2={};for(var r=0;r<e.length;r++)for(var n=2;8192>=n;n*=2){var t=n*e.length+r;v.table1[t]=Math.round(4294967295*Math.random()),v.table2[t]=Math.round(4294967295*Math.random())}}for(var a=0,o=0,r=0;r<e.length;r++){var l=e[r];if(l){var t=l*e.length+r;a^=v.table1[t],o^=v.table2[t]}}return a+""+o}function c(){for(var e=document.getElementsByClassName("tile-container")[0],r=[],n=0;n<e.children.length;n++){var t=e.children[n],a=t.children[0],l=parseInt(a.innerHTML),i=t.className,f="tile-position-",u=i.indexOf(f)+f.length,v=i.substring(u,u+3),c=parseInt(v[2])-1,s=parseInt(v[0])-1;r.push({value:l,row:c,col:s})}for(var d=new Array(A*A),n=0;n<d.length;n++)d[n]=0;for(var n=0;n<r.length;n++){var t=r[n];o(d,t.row,t.col,t.value)}return d}function s(e){var r=new Event("keydown",{bubbles:!0,cancelable:!0});r.altKey=!1,r.char="",r.charCode=0,r.ctrlKey=!1,r.defaultPrevented=!1,r.eventPhase=3,r.isTrusted=!0,r.key=e.key,r.keyCode=e.keyCode,r.locale="en-CA",r.location=0,r.metaKey=!1,r.repeat=!1,r.shiftKey=!1,r.which=e.keyCode,document.body.dispatchEvent(r)}function d(){var e=document.getElementsByClassName("game-message")[0];return e.className.indexOf("game-over")>=0}function m(){var e=document.getElementsByClassName("game-message")[0];return e.className.indexOf("game-won")>=0}function h(){var e=document.getElementsByClassName("retry-button")[0];e.click()}function g(){var e=document.getElementsByClassName("keep-playing-button")[0];e.click()}function y(){var e=document.getElementsByClassName("score-container")[0];return parseInt(e.innerHTML)}for(var b=4,k=50,M=1e3,N=-999999,p=!1,w=5,I=-.5,C=-2,E=.04,B=[0,0,0,10,0,0,0,15,0,0,-5,20,10,15,20,50],T={},x=0;20>x;x++)T[1<<x]=x;var A=4,O={drow:-1,dcol:0,dir:0,keyCode:38,key:"Up"},L={drow:1,dcol:0,dir:1,keyCode:40,key:"Down"},K={drow:0,dcol:-1,dir:0,keyCode:37,key:"Left"},P={drow:0,dcol:1,dir:1,keyCode:39,key:"Right"};if(p){var V=c();l(V),n(V,!0)}else setInterval(e,k);var D=0,F=0,G=0,H=0,S=0;setInterval(function(){if(m()&&g(),d()){var e=y();F=Math.max(F,e);for(var n=c(),t=0,a=0;a<n.length;a++)t=Math.max(t,n[a]);H=Math.max(H,t),G=(G*D+e)/(D+1),S=(S*D+t)/(D+1),D++,console.log("Game                   "+D+"\nScore                  "+e+"\nLargest tile           "+t+"\nAverage score          "+Math.round(G)+"\nAverage largest tile   "+Math.round(S)+"\nBest score             "+F+"\nBest largest tile      "+H+"\n\n"),r.table={},h()}},M)}();
